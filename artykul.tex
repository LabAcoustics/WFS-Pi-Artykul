% !TeX spellcheck = pl_PL
\documentclass[12pt]{oska}

% Lista wszystkich języków stanowiących języki pozycji bibliograficznych użytych w pracy.
% (Zgodnie z zasadami tworzenia bibliografii każda pozycja powinna zostać utworzona zgodnie z zasadami języka, w którym dana publikacja została napisana.)
\usepackage[english,polish]{babel}

% Użyj polskiego łamania wyrazów (zamiast domyślnego angielskiego).
\usepackage{polski}

\usepackage[utf8]{inputenc}

% dodatkowe pakiety
\usepackage{mathtools}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{bm}
\usepackage{adjustbox}
\usepackage[dvipsnames]{xcolor}
\usepackage{textcomp}

% obrazki
\usepackage{graphicx}
\usepackage{rotating}
\usepackage{caption}
\usepackage{float}

% --- < bibliografia > ---

\usepackage{placeins}	% poprawia float

\let\Oldsection\section
\renewcommand{\section}{\FloatBarrier\Oldsection}

\let\Oldsubsection\subsection
\renewcommand{\subsection}{\FloatBarrier\Oldsubsection}

\let\Oldsubsubsection\subsubsection
\renewcommand{\subsubsection}{\FloatBarrier\Oldsubsubsection}

\usepackage[
style=numeric,
sorting=none,
% Zastosuj styl wpisu bibliograficznego właściwy językowi publikacji.
language=autobib,
autolang=other,
% Zapisuj datę dostępu do strony WWW w formacie RRRR-MM-DD
%urldate=iso,
%seconds=true,
% Nie dodawaj numerów stron, na których występuje cytowanie
backref=false,
% Podawaj ISBN.
isbn=true,
% Nie podawaj URL-i, o ile nie jest to konieczne
url=false,
% Ustawienia związane z polskimi normami dla bibliografii
maxbibnames=6,
minbibnames=6,
% Jeżeli używamy Bibera:
backend=biber
]{biblatex}

\AtBeginBibliography{
\renewcommand\labelnamepunct{:\space}
\renewcommand\newunitpunct{\addcomma\space}
\renewcommand{\finentrypunct}{}

\renewcommand{\bibopenparen}{\addcomma\addspace}
\renewcommand{\bibcloseparen}{\addspace}
}

\usepackage{csquotes}
% Ponieważ `csquotes` nie posiada polskiego stylu, można skorzystać z mocno zbliżonego stylu chorwackiego.
\DeclareQuoteAlias{croatian}{polish}

% Przecinki do numerów
\usepackage{icomma}
% ------------------------

% --- < listingi > ---

% Użyj czcionki kroju Times.
\usepackage{newtxtext}

\usepackage{listings}
\lstloadlanguages{TeX}

\lstset{
	literate={ą}{{\k{a}}}1
           {ć}{{\'c}}1
           {ę}{{\k{e}}}1
           {ó}{{\'o}}1
           {ń}{{\'n}}1
           {ł}{{\l{}}}1
           {ś}{{\'s}}1
           {ź}{{\'z}}1
           {ż}{{\.z}}1
           {Ą}{{\k{A}}}1
           {Ć}{{\'C}}1
           {Ę}{{\k{E}}}1
           {Ó}{{\'O}}1
           {Ń}{{\'N}}1
           {Ł}{{\L{}}}1
           {Ś}{{\'S}}1
           {Ź}{{\'Z}}1
           {Ż}{{\.Z}}1,
	basicstyle=\footnotesize\ttfamily,
}

% ------------------------

\AtBeginDocument{
	\renewcommand{\tablename}{\textbf{Tabela}}
	\renewcommand{\figurename}{\textbf{Rysunek}}
}

% ------------------------
% --- < tabele > ---

\usepackage{array}
\usepackage{tabularx}
\usepackage{multirow}
\usepackage{booktabs}
\usepackage{makecell}
\usepackage[flushleft]{threeparttable}

% defines the X column to use m (\parbox[c]) instead of p (`parbox[t]`)
\newcolumntype{C}[1]{>{\hsize=#1\hsize\centering\arraybackslash}X}

\setlength{\cftsecnumwidth}{10mm}
\setcounter{secnumdepth}{4}
\brokenpenalty=10000\relax

% ------------------------
% --- < do tego artykułu > ---
\sisetup{binary-units=true}
\DeclareSIUnit{\inch}{"}
\usepackage{import}

%---------------------------------------------------------------------------

\titlePL{Wielokanałowy system syntezy pola akustycznego}
\titleEN{Multichannel acoustic field synthesis system}
\affiliation{Akademia Górniczo-Hutnicza im. Stanisława Staszica w Krakowie}

%------------------------------------AUTORZY-----------------------

\namem{Marcel}
\surnamem{Piszak}
\email{marcel.piszak@gmail.com} % adres do korespondencji -- zazwyczaj głównego autora

% Jeśli jesteś jedynym autorem pracy - pozostaw poniższe pola puste

\namei{Szymon}
\surnamei{Mikulicz}

\nameii{Teresa}
\surnameii{Makuch}

\nameiii{Michał}
\surnameiii{Kmiecik}

\nameiiii{}
\surnameiiii{}

\nameiiiii{}
\surnameiiiii{}

%--------------------------STRESZCZENIE------------------------

\summaryPL{%
  Projekt obejmuje stworzenie systemu WFS (Wave Field Synthesis) opartego na
  macierzy głośników oraz komputerach Raspberry Pi. Rozwój tej technologii
  pozwala na osiągnięcie wrażeń przestrzennych niezależnych od punktu odsłuchu.
  Głośniki zawarte w macierzy, poprzez zastosowanie odpowiedniego przetwarzania
  sygnałów wejściowych, są w stanie formować kształt czoła fali akustycznej w
  taki sposób, aby kreować pozorne źródło dźwięku. Modułowość konstrukcji pozwala
  na jednoczesne niezależne przetwarzanie dużej liczby sygnałów oraz wysyłanie
  ich do poszczególnych kanałów. Jednocześnie umożliwia to  rozszerzanie systemu
  o kolejne macierze głośników, dzięki czemu możliwa jest dokładniejsza synteza
  pola akustycznego.
}

\summaryEN{}

%---------------------------------------------------------
% Nazwa pliku z bibliografią
%---------------------------------------------------------
\addbibresource{bibliografia.bib}


\begin{document}

\maketitles

\section{Wstęp}

Reprodukcja dźwięku jest bardzo szerokim zagadnieniem akustyki. W obecnych
czasach istnieje wiele technik pozwalających na odtworzenie panujących w
wybranym miejscu warunków akustycznych w zgoła innym otoczeniu. Złożoność
zjawisk związanych z propagacją fali akustycznej w rzeczywistym środowisku
sprawia, że omawiane zagadnienie staję się złożonym problemem. Jedną z
naistotniejszych trudności napotykanych podczas projektowania systemu
reprodukcji dźwięku jest ograniczenie przestrzeni dokładnego odwzorowania do
punku, a właściwie niewielkiego obszaru wokół niego (tzw. sweet-spot).
Istnienie takiego ograniczenia wyklucza zastosowanie takich systemów w
sytuacjach, gdy mamy do czynienia z odbiornikiem wykonującym ruch w strefie
odsłuchu. Z pomocą przychodzą jednak systemy syntezy pola akustycznego (Wave
Field Synthesis - WFS), które bazując na dużej liczbie głośników są w stanie
imitować fale akustyczne generowane przez źródła usytuowane nawet w dużej
odległości oraz będące w ruchu, ale co najważniejsze nie ograniczają strefy
odsłuchu do punktu. Obecnie istnieją różne warianty systemów WFS, projektowane
często z myślą o konkretnym zastosowaniu [cite cośtam]. Celem niniejszej pracy
było zaprojektowanie modułowego systemu syntezy pola akustycznego, opartego na
łatwo dostępnych komponentach i umożliwiającego stosunkowo prostą adaptację do
wybranego zastosowania.

\section{Synteza pola akustycznego}

WFS (synteza pola akustycznego) oparta jest na zasadzie Huygensa: każdy punkt
do którego dociera flaka akustyczna staje się źródłem nowej fali. Ta zasada
jest zaimplementowana poprzez konstrukcję szeregu głośników, gdzie każdy z nich
jest punktem do którego dotarła fala akustyczna wyemitowana przez wirtualne
źródło dźwięku, przekazując falę dalej, a więc ją tworząc, co pokazuje rysunek
\ref{r:Huygens}.

\begin{figure}[!tbh]
  \centering
  \includegraphics[scale=.4]{vecgraphics/WFS_idea.pdf}
  \caption{Zastosowanie zasady Huygensa w WFS: każdy głośnik jest punktem do
    którego dociera fala wyemitowana przez wirtualne źródło -- nowym źródłem
  dźwięku}
  \label{r:Huygens}
\end{figure}

Początkowym równaniem w WFS jest całka Helmholtza-Huygensa (lub całka
Kirchoffa-Helmholtza), analityczna metoda liczenia dystrybucji pola
akustycznego, która pozwala znaleźć ciśnienie akustyczne z danego zestawu
źródeł w każdym punkcie zdefiniowanej przestrzeni~\cite{snaka}. Jest używana do
zdefiniowania funkcji opisującej ciśnienie akustyczne w pozycji głośnika, który
jest używany jako wzbudnik. To podejście pozwala wziąć pod uwagę geometrię
przestrzeni oraz stratę energii przez transmisję.

\section{Projekt}

Przez konstrukcją systemu podjęto kroki w celu wyznaczenia jego pożądanej
charakterystyki. Między innymi:
\begin{itemize}
  \item wybrano rozmiar macierzy głośnikowej i wybrano pasujące elementy
    sprzętu, na podstawie wybranego zakresu częstotliwości.
  \item zaprojektowano algorytm przetwarzania sygnałów.
  \item przeprowadzono symulacje w oprogramowaniu wykorzystującym metodę
    elementów skończonych (MES), by zweryfikować dokładność algorytmu.
\end{itemize}

\section{Geometria}

Rozmiar macierzy głośnikowej determinuje zakres częstotliwości w którym system
jest w stanie odtwarzać dźwięk z dużą dokładnością. Wynika to z średnicy
membrany głośników użytych $\phi_l$ i faktu, że przyjęte źródło liniowe jest
tak naprawdę szeregiem dyskretnych źródeł, co oznacza że są oddalone o siebie o
odległość $\Delta x$. Im większa macierz tym niższa jest częstotliwość która
może być odtworzona, gdyż źródło jest wystarczająco duże w stosunku do długości
fali akustycznej; warunek \eqref{eq:fmin} musi być spełniony:
\begin{equation}
  f_{min}>\frac{c}{L} \quad,	\label{eq:fmin}
\end{equation}
gdzie $L$~[m] to długość macierzy. Dla wyższej częstotliwości, zjawisko
aliasingu przestrzennego musi być wzięte pod uwagę. Od pewnej częstotliwości,
odległości pomiędzy głośnikami powodują różnice fazowe które powodują
interferencje konstruktywną i destruktywną. To dzieje się dla częstotliwości
powyżej granicy~\eqref{eq:fmax}:
\begin{equation}
  f_{max}=\frac{c}{2\Delta x \sin{\alpha_{max}}} \quad, \label{eq:fmax}
\end{equation}
gdzie $\alpha_{max}$ to maksymalny kąt pomiędzy padającą fala wirtualną a
macierzą głośnikową. Natomiast ten efekt nie zniekształca dźwięku znacząca,
wobec czego może być zaakceptowany~\cite{hq_rendering}.

Wzięwszy pod uwagę możliwe rozwiązania, głośniki o wymiarze 3''
(\SI{81}{\milli\meter}) średnicy zostały wybrane, rozmieszczone o
$\Delta x=\SI{150}{\milli\meter}$.

\section{Przetwarzanie sygnałów}\label{s:algorithm}

Uzyskanie sygnałów podawanych na głośniki, na podstawie geometrii i całki
Helmholtza-Huygensa, może być opisane przez
wzór~\eqref{eq:glosnik_f}~\cite{delay}:

\begin{equation}
  Q_n(\bm{r}_n,\omega) = \sqrt{\frac{j\omega}{2\pi c}} A_n \frac {e^{-jk|\bm{r}_n-\bm{r}_m|}}{|\bm{r}_n-\bm{r}_m|^{1/2}} S(\omega) \quad,
  \label{eq:glosnik_f}
\end{equation}

gdzie $A_n$ to współczynnik wagowy amplitudy a wyrażenie
$|\bm{r}_n-\bm{r}_m|$ opisuje dystans pomiędzy źródłem wirtualnych
a $n$-tym głośnikiem, natomiast $S(\omega)$ to spektrum sygnału źródłowego.

Toteż sygnał źródła wirtualnego $s(t)$ dla każdego głośnika musi być pomnożony
przez współczynnik wagowy amplitudy $a_n$, przefiltrowany przez odwrotną
transformatę Fouriera $\sqrt{\frac{j\omega}{2\pi c}}$, spleciony z $h(t)$, i
opóźniony o $\tau_n$, co może być zapisane w postaci~\eqref{eq:glosnik_t}~\cite{enhancement}:

\begin{equation}
  q_n(t) = a_n\left[h(t)*s(t)*\delta(t-\tau_n)\right] \quad. \label{eq:glosnik_t}
\end{equation}

\section{Symulacja}

By przeprowadzić ewaluację dokładności algorytmu, symulacja dystrybucji pola
akustycznego została przeprowadzona. Dwa modele zostały stworzone: jeden z
źródłem rzeczywistym na pozycji $S$ i przegrodą z otworami imitującą macierz
głośnikową, pokazujący estymowaną przestrzeń syntezy i drugi ze źródłami
punktowymi emulującymi głośniki, emitującymi sygnał ze źródła wirtualnego $S$,
wyznaczony przez algorytm wyznaczony w sekcji~\ref{s:algorithm}.

Dla każdego modelu, analiza wykorzystująca MES została przeprowadzona, by
porównać pole akustyczne wytworzone przez źródło rzeczywiste i głośniki
symulujące je. Wyniki przedstawia rysunek~\ref{r:fem}, pokazując dużą zbieżność
pomiędzy modelami.

\begin{figure}[!tbh]
  \centering
  \adjincludegraphics[width=0.7\columnwidth,trim={{.15\width} {.03\height} {.15\width} 0},clip]{vecgraphics/real_500Hz.png}
  \adjincludegraphics[width=0.7\columnwidth,trim={{.15\width} 0 {.15\width} {.02\height}},clip]{vecgraphics/virtual_500Hz.png}
  \caption{Results of the wave field simulation with FEM: acoustic
    pressure distribution for real source (top) and loudspeaker array
  emulating virtual source in the same position (bottom)}
  \label{r:fem}
\end{figure}


\section{Realizacja}

Zdecydowano się na zastosowanie rozwiązania opartego na komputerach Raspberry
Pi Zero. Są one niewielkie i dysponują odpowiednią mocą obliczeniową potrzebną
do przetwarzania sygnałów wysyłanych na odpowiednie kanały. Przetwarzanie
sygnału na z cyfrowego na analogowy oraz jego wzmocnienie jest realizowane
przez moduł Amp Zero pHAT firmy JustBoom. Jest to połączenie wysokiej jakości
przetwornika analogowo-cyfrowego oraz wzmacniacza klasy D o mocy wyjściowej
$2\times40\si{\watt}$. Sygnał może być próbkowany z częstotliwością
\SI{192}{\kilo\hertz} i rozdzielczością \SI{32}{\bit}, z kolei zastosowanie
wzmacniacza klasy D umożliwia osiąganie odpowiedniej mocy głośników bez
zużywania nadmiernej ilości energii oraz zachowując niewielkie rozmiary
pojedynczych modułów. 
Wybrano głośniki firmy Faital Pro model 3FE25. Podstawowe parametry
przedstawiono w tabeli \ref{tab:paramglosnik}.

\begin{table}[!tbh]
  \centering
  \caption{Parametry głośnika Faital Pro 3FE25}
  \begin{tabular}{|c|c|} \hline
    \textbf{Parametr} & \textbf{Wartość} \\ \hline
    Średnica & \SI{3}{\inch} \\ \hline
    Impedancja nominalna & \SI{8}{\ohm} \\ \hline
    Moc nominalna & \SI{20}{\watt} \\ \hline
    Skuteczność (\SI{1}{\watt} / \SI{1}{\metre}) & \SI{91}{\decibel} \\ \hline
    Zakres częstotliwości & od \SI{100}{\hertz} do \SI{20}{\kilo\hertz} \\ \hline
  \end{tabular}
  \label{tab:paramglosnik}
\end{table}

Ponieważ moduły wzmacniaczy oraz przetworników A/C były dwukanałowe, na każdy
moduł oraz komputer Raspberry Pi przypadły dwa głośniki. W celu zwiększenia
możliwości adaptacji systemu do wymaganych warunków postanowiono każdy głośnik
umieścić w oddzielnej obudowie tak, aby istniała możliwość zmiany zarówno
odległości jak i kąta pomiędzy poszczególnymi żródłami macierzy głośnikowej.
Strukturę systemu przedstawia rysunek \ref{fig:schemat}.

\begin{figure}[!tbh]
  \centering
  \import{./vecgraphics/}{scheme.pdf_tex}
  \caption{Schemat projektowanego systemu WFS}
  \label{fig:schemat}
\end{figure}

Ważnym aspektem system jest koherencja głośników. Wobec tego system posiada
połączenie synchronizujące, które synchronizuje przetwarzanie próbek dźwięku.
Rozwiązuje to problem nieprzewidywalnego czasu przetwarzania w systemie nie
wspierającym przetwarzania w czasie rzeczywistym.

Połączenie synchronizujące wykorzystuje piny GPIO. Dane audio oraz informacje
na temat lokalizacji przesyłane są bezprzewodowo przez sieć lokalną (LAN), co
oznacza że system nie może odtwarzać dźwięku w czasie rzeczywistym, lecz to
rozwiązanie pozwala na duże pole manewru i zmniejsza ilość kabli. Główna
jednostka systemu z aplikacją serwera kontroluje połączenie synchronizujące
oraz zarządza procesorami audio. To pozwala na rozszerzanie i zwiększanie
funkcjonalności systemu w przyszłości.

\section{Wnioski}
Zaprojektowany system, dzieki swojej modułowości pozawala na 


\printbibliography

\end{document}
